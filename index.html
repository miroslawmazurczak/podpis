<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Podpis</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px;
    }
    canvas {
      border: 2px solid #000;
      width: 300px; /* Ustaw stałą szerokość */
      height: 150px; /* Ustaw stałą wysokość */
      touch-action: none; /* Zapobiega przesuwaniu ekranu na urządzeniach mobilnych */
    }
    button {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h2>Podpisz się:</h2>
  <canvas id="signature-pad" width="300" height="150"></canvas>
  <button onclick="clearSignature()">Wyczyść</button>
  <button onclick="sendSignature()">Wyślij podpis</button>

  <script>
    const canvas = document.getElementById("signature-pad");
    const ctx = canvas.getContext("2d");

    let isDrawing = false;

    canvas.addEventListener("mousedown", (e) => startDrawing(e));
    canvas.addEventListener("mouseup", () => stopDrawing());
    canvas.addEventListener("mousemove", (e) => draw(e));

    canvas.addEventListener("touchstart", (e) => startDrawing(e.touches[0]));
    canvas.addEventListener("touchend", () => stopDrawing());
    canvas.addEventListener("touchmove", (e) => draw(e.touches[0]));

    function startDrawing(event) {
      isDrawing = true;
      ctx.beginPath();
      ctx.moveTo(
        event.clientX - canvas.getBoundingClientRect().left,
        event.clientY - canvas.getBoundingClientRect().top
      );
    }

    function draw(event) {
      if (!isDrawing) return;
      ctx.lineTo(
        event.clientX - canvas.getBoundingClientRect().left,
        event.clientY - canvas.getBoundingClientRect().top
      );
      ctx.strokeStyle = "black";
      ctx.lineWidth = 2;
      ctx.lineCap = "round";
      ctx.stroke();
    }

    function stopDrawing() {
      isDrawing = false;
      ctx.closePath();
    }

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function sendSignature() {
      const signatureData = canvas.toDataURL("image/png"); // Konwertujemy podpis na Base64
      const fileName = `podpis_${new Date().toISOString().slice(0, 10)}.png`;

      fetch('https://script.google.com/macros/s/AKfycbx-8yv6ffVStRPdyV-iL4WuiQ5gBX22SIkIIIJHHndi0UtzrwMga6naQV5xCdAVrwcg/exec', {
        method: 'POST',
        mode: 'cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          signature: signatureData,
          fileName: fileName
        })
      })
      .then(response => response.json())
      .then(data => alert(data.message))
      .catch(error => alert("Błąd: " + error.message));
    }
  </script>
</body>
</html>
